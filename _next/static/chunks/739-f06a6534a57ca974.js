"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[739],{5417:function(t,e,i){let s,r,h,o,a,n,l,_,c,d,m,p,u,E,T,g,O,y,f,v,C,U,x;i.d(e,{B:function(){return $}});var L,D=i(1119),A=i(1448),w=i(2265),R=i(8478);let z={LEFT:1,RIGHT:2,MIDDLE:4},S=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),F={NONE:0,IN:1,OUT:-1};function P(t){return t.isPerspectiveCamera}function b(t){return t.isOrthographicCamera}let M=2*Math.PI,H=Math.PI/2,V=Math.PI/180;function k(t,e,i){return Math.max(e,Math.min(i,t))}function Y(t,e=1e-5){return Math.abs(t)<e}function Z(t,e,i=1e-5){return Y(t-e,i)}function I(t,e){return Math.round(t/e)*e}function N(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function B(t){return Math.abs(t)<Number.MAX_VALUE?t:1/0*t}function K(t,e,i,s,r=1/0,h){let o=2/(s=Math.max(1e-4,s)),a=o*h,n=1/(1+a+.48*a*a+.235*a*a*a),l=t-e,_=e,c=r*s;e=t-(l=k(l,-c,c));let d=(i.value+o*l)*h;i.value=(i.value-o*d)*n;let m=e+(l+d)*n;return _-t>0==m>_&&(m=_,i.value=(m-_)/h),m}function X(t,e,i,s,r=1/0,h,o){let a=2/(s=Math.max(1e-4,s)),n=a*h,l=1/(1+n+.48*n*n+.235*n*n*n),_=e.x,c=e.y,d=e.z,m=t.x-_,p=t.y-c,u=t.z-d,E=_,T=c,g=d,O=r*s,y=m*m+p*p+u*u;if(y>O*O){let t=Math.sqrt(y);m=m/t*O,p=p/t*O,u=u/t*O}_=t.x-m,c=t.y-p,d=t.z-u;let f=(i.x+a*m)*h,v=(i.y+a*p)*h,C=(i.z+a*u)*h;i.x=(i.x-a*f)*l,i.y=(i.y-a*v)*l,i.z=(i.z-a*C)*l,o.x=_+(m+f)*l,o.y=c+(p+v)*l,o.z=d+(u+C)*l;let U=E-t.x,x=T-t.y,L=g-t.z;return U*(o.x-E)+x*(o.y-T)+L*(o.z-g)>0&&(o.x=E,o.y=T,o.z=g,i.x=(o.x-E)/h,i.y=(o.y-T)/h,i.z=(o.z-g)/h),o}function Q(t,e){e.set(0,0),t.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=t.length,e.y/=t.length}function j(t,e){return!!b(t)&&(console.warn(`${e} is not supported in OrthographicCamera`),!0)}class q{constructor(){this._listeners={}}addEventListener(t,e){let i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){let i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){let i=this._listeners[t];if(void 0!==i){let t=i.indexOf(e);-1!==t&&i.splice(t,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){let e=this._listeners[t.type];if(void 0!==e){t.target=this;let i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t)}}}let G=1/8,W=/Mac/.test(null===(L=null==globalThis?void 0:globalThis.navigator)||void 0===L?void 0:L.platform);class J extends q{static install(t){r=Object.freeze(new(s=t.THREE).Vector3(0,0,0)),h=Object.freeze(new s.Vector3(0,1,0)),o=Object.freeze(new s.Vector3(0,0,1)),a=new s.Vector2,n=new s.Vector3,l=new s.Vector3,_=new s.Vector3,c=new s.Vector3,d=new s.Vector3,m=new s.Vector3,p=new s.Vector3,u=new s.Vector3,E=new s.Vector3,T=new s.Spherical,g=new s.Spherical,O=new s.Box3,y=new s.Box3,f=new s.Sphere,v=new s.Quaternion,C=new s.Quaternion,U=new s.Matrix4,x=new s.Raycaster}static get ACTION(){return S}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=S.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=F.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new s.Vector3,this._focalOffsetVelocity=new s.Vector3,this._zoomVelocity={value:0},this._truckInternal=(t,e,i)=>{let s,r;if(P(this._camera)){let i=n.copy(this._camera.position).sub(this._target),h=this._camera.getEffectiveFOV()*V,o=i.length()*Math.tan(.5*h);s=this.truckSpeed*t*o/this._elementRect.height,r=this.truckSpeed*e*o/this._elementRect.height}else{if(!b(this._camera))return;let i=this._camera;s=t*(i.right-i.left)/i.zoom/this._elementRect.width,r=e*(i.top-i.bottom)/i.zoom/this._elementRect.height}this.verticalDragToForward?(i?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(s,0,!0),this.forward(-r,!0)):i?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y+r,this._focalOffsetEnd.z,!0):this.truck(s,r,!0)},this._rotateInternal=(t,e)=>{let i=M*this.azimuthRotateSpeed*t/this._elementRect.height,s=M*this.polarRotateSpeed*e/this._elementRect.height;this.rotate(i,s,!0)},this._dollyInternal=(t,e,i)=>{let s=Math.pow(.95,-t*this.dollySpeed),r=this._sphericalEnd.radius,h=this._sphericalEnd.radius*s,o=k(h,this.minDistance,this.maxDistance);this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(h,!0):(this.infinityDolly&&!this.dollyToCursor&&this.dollyInFixed(o-h,!0),this._dollyToNoClamp(o,!0)),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?h:o)-r,this._dollyControlCoord.set(e,i)),this._lastDollyDirection=Math.sign(-t)},this._zoomInternal=(t,e,i)=>{let s=Math.pow(.95,t*this.dollySpeed),r=this._zoom,h=this._zoom*s;this.zoomTo(h,!0),this.dollyToCursor&&(this._changedZoom+=h-r,this._dollyControlCoord.set(e,i))},void 0===s&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new s.Quaternion().setFromUnitVectors(this._camera.up,h),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=S.NONE,this._target=new s.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new s.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new s.Spherical().setFromVector3(n.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3],this._updateNearPlaneCorners(),this._boundary=new s.Box3(new s.Vector3(-1/0,-1/0,-1/0),new s.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new s.Vector2,this.mouseButtons={left:S.ROTATE,middle:S.DOLLY,right:S.TRUCK,wheel:P(this._camera)?S.DOLLY:b(this._camera)?S.ZOOM:S.NONE},this.touches={one:S.TOUCH_ROTATE,two:P(this._camera)?S.TOUCH_DOLLY_TRUCK:b(this._camera)?S.TOUCH_ZOOM_TRUCK:S.NONE,three:S.TOUCH_TRUCK};let i=new s.Vector2,r=new s.Vector2,o=new s.Vector2,l=t=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let e=this._domElement.getBoundingClientRect(),i=t.clientX/e.width,s=t.clientY/e.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||s<this._interactiveArea.top||s>this._interactiveArea.bottom)return}let e="mouse"!==t.pointerType?null:(t.buttons&z.LEFT)===z.LEFT?z.LEFT:(t.buttons&z.MIDDLE)===z.MIDDLE?z.MIDDLE:(t.buttons&z.RIGHT)===z.RIGHT?z.RIGHT:null;if(null!==e){let t=this._findPointerByMouseButton(e);t&&this._disposePointer(t)}if((t.buttons&z.LEFT)===z.LEFT&&this._lockedPointer)return;let i={pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0,mouseButton:e};this._activePointers.push(i),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,u(t)},_=t=>{t.cancelable&&t.preventDefault();let e=t.pointerId,i=this._lockedPointer||this._findPointerById(e);if(i){if(i.clientX=t.clientX,i.clientY=t.clientY,i.deltaX=t.movementX,i.deltaY=t.movementY,this._state=0,"touch"===t.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(t.buttons&z.LEFT)===z.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(t.buttons&z.MIDDLE)===z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(t.buttons&z.RIGHT)===z.RIGHT&&(this._state=this._state|this.mouseButtons.right);E()}},c=t=>{let e=this._findPointerById(t.pointerId);if(!e||e!==this._lockedPointer){if(e&&this._disposePointer(e),"touch"===t.pointerType)switch(this._activePointers.length){case 0:this._state=S.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=S.NONE;T()}},d=-1,m=t=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===S.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let e=this._domElement.getBoundingClientRect(),i=t.clientX/e.width,s=t.clientY/e.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||s<this._interactiveArea.top||s>this._interactiveArea.bottom)return}if(t.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===S.ROTATE||this.mouseButtons.wheel===S.TRUCK){let t=performance.now();d-t<1e3&&this._getClientRect(this._elementRect),d=t}let e=W?-1:-3,i=1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e),s=this.dollyToCursor?(t.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,r=this.dollyToCursor?-((t.clientY-this._elementRect.y)/this._elementRect.height*2)+1:0;switch(this.mouseButtons.wheel){case S.ROTATE:this._rotateInternal(t.deltaX,t.deltaY),this._isUserControllingRotate=!0;break;case S.TRUCK:this._truckInternal(t.deltaX,t.deltaY,!1),this._isUserControllingTruck=!0;break;case S.OFFSET:this._truckInternal(t.deltaX,t.deltaY,!0),this._isUserControllingOffset=!0;break;case S.DOLLY:this._dollyInternal(-i,s,r),this._isUserControllingDolly=!0;break;case S.ZOOM:this._zoomInternal(-i,s,r),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},p=t=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===J.ACTION.NONE){let e=t instanceof PointerEvent?t.pointerId:0,i=this._findPointerById(e);i&&this._disposePointer(i),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}t.preventDefault()}},u=t=>{if(this._enabled){if(Q(this._activePointers,a),this._getClientRect(this._elementRect),i.copy(a),r.copy(a),this._activePointers.length>=2){let t=a.x-this._activePointers[1].clientX,e=a.y-this._activePointers[1].clientY;o.set(0,Math.sqrt(t*t+e*e));let i=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,s=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(i,s)}if(this._state=0,t){if("pointerType"in t&&"touch"===t.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(t.buttons&z.LEFT)!==z.LEFT||(this._state=this._state|this.mouseButtons.left),(t.buttons&z.MIDDLE)===z.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(t.buttons&z.RIGHT)===z.RIGHT&&(this._state=this._state|this.mouseButtons.right)}else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);((this._state&S.ROTATE)===S.ROTATE||(this._state&S.TOUCH_ROTATE)===S.TOUCH_ROTATE||(this._state&S.TOUCH_DOLLY_ROTATE)===S.TOUCH_DOLLY_ROTATE||(this._state&S.TOUCH_ZOOM_ROTATE)===S.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&S.TRUCK)===S.TRUCK||(this._state&S.TOUCH_TRUCK)===S.TOUCH_TRUCK||(this._state&S.TOUCH_DOLLY_TRUCK)===S.TOUCH_DOLLY_TRUCK||(this._state&S.TOUCH_ZOOM_TRUCK)===S.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&S.DOLLY)===S.DOLLY||(this._state&S.TOUCH_DOLLY)===S.TOUCH_DOLLY||(this._state&S.TOUCH_DOLLY_TRUCK)===S.TOUCH_DOLLY_TRUCK||(this._state&S.TOUCH_DOLLY_OFFSET)===S.TOUCH_DOLLY_OFFSET||(this._state&S.TOUCH_DOLLY_ROTATE)===S.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&S.ZOOM)===S.ZOOM||(this._state&S.TOUCH_ZOOM)===S.TOUCH_ZOOM||(this._state&S.TOUCH_ZOOM_TRUCK)===S.TOUCH_ZOOM_TRUCK||(this._state&S.TOUCH_ZOOM_OFFSET)===S.TOUCH_ZOOM_OFFSET||(this._state&S.TOUCH_ZOOM_ROTATE)===S.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&S.OFFSET)===S.OFFSET||(this._state&S.TOUCH_OFFSET)===S.TOUCH_OFFSET||(this._state&S.TOUCH_DOLLY_OFFSET)===S.TOUCH_DOLLY_OFFSET||(this._state&S.TOUCH_ZOOM_OFFSET)===S.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},E=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Q(this._activePointers,a);let t=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,e=t?-t.deltaX:r.x-a.x,s=t?-t.deltaY:r.y-a.y;if(r.copy(a),((this._state&S.ROTATE)===S.ROTATE||(this._state&S.TOUCH_ROTATE)===S.TOUCH_ROTATE||(this._state&S.TOUCH_DOLLY_ROTATE)===S.TOUCH_DOLLY_ROTATE||(this._state&S.TOUCH_ZOOM_ROTATE)===S.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(e,s),this._isUserControllingRotate=!0),(this._state&S.DOLLY)===S.DOLLY||(this._state&S.ZOOM)===S.ZOOM){let t=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,e=this.dollyToCursor?-((i.y-this._elementRect.y)/this._elementRect.height*2)+1:0,r=this.dollyDragInverted?-1:1;(this._state&S.DOLLY)===S.DOLLY?(this._dollyInternal(r*s*G,t,e),this._isUserControllingDolly=!0):(this._zoomInternal(r*s*G,t,e),this._isUserControllingZoom=!0)}if((this._state&S.TOUCH_DOLLY)===S.TOUCH_DOLLY||(this._state&S.TOUCH_ZOOM)===S.TOUCH_ZOOM||(this._state&S.TOUCH_DOLLY_TRUCK)===S.TOUCH_DOLLY_TRUCK||(this._state&S.TOUCH_ZOOM_TRUCK)===S.TOUCH_ZOOM_TRUCK||(this._state&S.TOUCH_DOLLY_OFFSET)===S.TOUCH_DOLLY_OFFSET||(this._state&S.TOUCH_ZOOM_OFFSET)===S.TOUCH_ZOOM_OFFSET||(this._state&S.TOUCH_DOLLY_ROTATE)===S.TOUCH_DOLLY_ROTATE||(this._state&S.TOUCH_ZOOM_ROTATE)===S.TOUCH_ZOOM_ROTATE){let t=a.x-this._activePointers[1].clientX,e=a.y-this._activePointers[1].clientY,i=Math.sqrt(t*t+e*e),s=o.y-i;o.set(0,i);let h=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,n=this.dollyToCursor?-((r.y-this._elementRect.y)/this._elementRect.height*2)+1:0;(this._state&S.TOUCH_DOLLY)===S.TOUCH_DOLLY||(this._state&S.TOUCH_DOLLY_ROTATE)===S.TOUCH_DOLLY_ROTATE||(this._state&S.TOUCH_DOLLY_TRUCK)===S.TOUCH_DOLLY_TRUCK||(this._state&S.TOUCH_DOLLY_OFFSET)===S.TOUCH_DOLLY_OFFSET?(this._dollyInternal(s*G,h,n),this._isUserControllingDolly=!0):(this._zoomInternal(s*G,h,n),this._isUserControllingZoom=!0)}((this._state&S.TRUCK)===S.TRUCK||(this._state&S.TOUCH_TRUCK)===S.TOUCH_TRUCK||(this._state&S.TOUCH_DOLLY_TRUCK)===S.TOUCH_DOLLY_TRUCK||(this._state&S.TOUCH_ZOOM_TRUCK)===S.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(e,s,!1),this._isUserControllingTruck=!0),((this._state&S.OFFSET)===S.OFFSET||(this._state&S.TOUCH_OFFSET)===S.TOUCH_OFFSET||(this._state&S.TOUCH_DOLLY_OFFSET)===S.TOUCH_DOLLY_OFFSET||(this._state&S.TOUCH_ZOOM_OFFSET)===S.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(e,s,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},T=()=>{Q(this._activePointers,a),r.copy(a),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",g),this._domElement.ownerDocument.addEventListener("pointerlockerror",O),this._domElement.ownerDocument.addEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),u())},this.unlockPointer=()=>{var t,e,i;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(t=this._domElement)||void 0===t||t.ownerDocument.exitPointerLock(),null===(e=this._domElement)||void 0===e||e.ownerDocument.removeEventListener("pointerlockchange",g),null===(i=this._domElement)||void 0===i||i.ownerDocument.removeEventListener("pointerlockerror",O),this.cancel()};let g=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},O=()=>{this.unlockPointer()};this._addAllEventListeners=t=>{this._domElement=t,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",l),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",m,{passive:!1}),this._domElement.addEventListener("contextmenu",p)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",l),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",m,{passive:!1}),this._domElement.removeEventListener("contextmenu",p),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",g),this._domElement.ownerDocument.removeEventListener("pointerlockerror",O))},this.cancel=()=>{this._state!==S.NONE&&(this._state=S.NONE,this._activePointers.length=0,T())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){(this._spherical.radius!==t||this._sphericalEnd.radius!==t)&&(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){(this._spherical.theta!==t||this._sphericalEnd.theta!==t)&&(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){(this._spherical.phi!==t||this._sphericalEnd.phi!==t)&&(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=k(t.width,0,1),this._interactiveArea.height=k(t.height,0,1),this._interactiveArea.x=k(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=k(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){this._isUserControllingRotate=!1;let s=k(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=k(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=s,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let h=!i||Z(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Z(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(h)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=F.NONE,this._changedDolly=0,this._dollyToNoClamp(k(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){let i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let e=this._collisionTest(),s=Z(e,this._spherical.radius);if(!(i>t)&&s)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,e)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);let s=!e||Z(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(c).multiplyScalar(t)),e||this._target.copy(this._targetEnd);let i=!e||Z(this._target.x,this._targetEnd.x,this.restThreshold)&&Z(this._target.y,this._targetEnd.y,this.restThreshold)&&Z(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=k(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);let i=!e||Z(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,e,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),d.setFromMatrixColumn(this._camera.matrix,0),m.setFromMatrixColumn(this._camera.matrix,1),d.multiplyScalar(t),m.multiplyScalar(-e);let s=n.copy(d).add(m),r=l.copy(this._targetEnd).add(s);return this.moveTo(r.x,r.y,r.z,i)}forward(t,e=!1){n.setFromMatrixColumn(this._camera.matrix,0),n.crossVectors(this._camera.up,n),n.multiplyScalar(t);let i=l.copy(this._targetEnd).add(n);return this.moveTo(i.x,i.y,i.z,e)}elevate(t,e=!1){return n.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+n.x,this._targetEnd.y+n.y,this._targetEnd.z+n.z,e)}moveTo(t,e,i,s=!1){this._isUserControllingTruck=!1;let r=n.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,s||this._target.copy(this._targetEnd);let h=!s||Z(this._target.x,this._targetEnd.x,this.restThreshold)&&Z(this._target.y,this._targetEnd.y,this.restThreshold)&&Z(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(h)}lookInDirectionOf(t,e,i,s=!1){let r=n.set(t,e,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,s)}fitToBox(t,e,{cover:i=!1,paddingLeft:s=0,paddingRight:r=0,paddingBottom:a=0,paddingTop:_=0}={}){let c=[],d=t.isBox3?O.copy(t):O.setFromObject(t);d.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let m=I(this._sphericalEnd.theta,H),p=I(this._sphericalEnd.phi,H);c.push(this.rotateTo(m,p,e));let u=n.setFromSpherical(this._sphericalEnd).normalize(),E=v.setFromUnitVectors(u,o),T=Z(Math.abs(u.y),1);T&&E.multiply(C.setFromAxisAngle(h,m)),E.multiply(this._yAxisUpSpaceInverse);let g=y.makeEmpty();l.copy(d.min).applyQuaternion(E),g.expandByPoint(l),l.copy(d.min).setX(d.max.x).applyQuaternion(E),g.expandByPoint(l),l.copy(d.min).setY(d.max.y).applyQuaternion(E),g.expandByPoint(l),l.copy(d.max).setZ(d.min.z).applyQuaternion(E),g.expandByPoint(l),l.copy(d.min).setZ(d.max.z).applyQuaternion(E),g.expandByPoint(l),l.copy(d.max).setY(d.min.y).applyQuaternion(E),g.expandByPoint(l),l.copy(d.max).setX(d.min.x).applyQuaternion(E),g.expandByPoint(l),l.copy(d.max).applyQuaternion(E),g.expandByPoint(l),g.min.x-=s,g.min.y-=a,g.max.x+=r,g.max.y+=_,E.setFromUnitVectors(o,u),T&&E.premultiply(C.invert()),E.premultiply(this._yAxisUpSpace);let f=g.getSize(n),U=g.getCenter(l).applyQuaternion(E);if(P(this._camera)){let t=this.getDistanceToFitBox(f.x,f.y,f.z,i);c.push(this.moveTo(U.x,U.y,U.z,e)),c.push(this.dollyTo(t,e)),c.push(this.setFocalOffset(0,0,0,e))}else if(b(this._camera)){let t=this._camera,s=t.right-t.left,r=t.top-t.bottom,h=i?Math.max(s/f.x,r/f.y):Math.min(s/f.x,r/f.y);c.push(this.moveTo(U.x,U.y,U.z,e)),c.push(this.zoomTo(h,e)),c.push(this.setFocalOffset(0,0,0,e))}return Promise.all(c)}fitToSphere(t,e){let i=[],s="isObject3D"in t?J.createBoundingSphere(t,f):f.copy(t);if(i.push(this.moveTo(s.center.x,s.center.y,s.center.z,e)),P(this._camera)){let t=this.getDistanceToFitSphere(s.radius);i.push(this.dollyTo(t,e))}else if(b(this._camera)){let t=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,h=2*s.radius;i.push(this.zoomTo(Math.min(t/h,r/h),e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,s,r,h,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=F.NONE,this._changedDolly=0;let a=l.set(s,r,h),_=n.set(t,e,i);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(_.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let c=!o||Z(this._target.x,this._targetEnd.x,this.restThreshold)&&Z(this._target.y,this._targetEnd.y,this.restThreshold)&&Z(this._target.z,this._targetEnd.z,this.restThreshold)&&Z(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Z(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Z(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(t,e,i,s,r,h,o,a,c,d,m,p,u,E=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=F.NONE,this._changedDolly=0;let O=n.set(s,r,h),y=l.set(t,e,i);T.setFromVector3(y.sub(O).applyQuaternion(this._yAxisUpSpace));let f=_.set(d,m,p),v=l.set(o,a,c);g.setFromVector3(v.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(O.lerp(f,u));let C=g.theta-T.theta,U=g.phi-T.phi,x=g.radius-T.radius;this._sphericalEnd.set(T.radius+x*u,T.phi+U*u,T.theta+C*u),this.normalizeRotations(),this._needsUpdate=!0,E||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let L=!E||Z(this._target.x,this._targetEnd.x,this.restThreshold)&&Z(this._target.y,this._targetEnd.y,this.restThreshold)&&Z(this._target.z,this._targetEnd.z,this.restThreshold)&&Z(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Z(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Z(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(L)}setPosition(t,e,i,s=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,s)}setTarget(t,e,i,s=!1){let r=this.getPosition(n),h=this.setLookAt(r.x,r.y,r.z,t,e,i,s);return this._sphericalEnd.phi=k(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),h}setFocalOffset(t,e,i,s=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,s||this._focalOffset.copy(this._focalOffsetEnd);let r=!s||Z(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Z(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Z(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,i){this._camera.updateMatrixWorld(),d.setFromMatrixColumn(this._camera.matrixWorldInverse,0),m.setFromMatrixColumn(this._camera.matrixWorldInverse,1),p.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let s=n.set(t,e,i),r=s.distanceTo(this._camera.position),h=s.sub(this._camera.position);d.multiplyScalar(h.x),m.multiplyScalar(h.y),p.multiplyScalar(h.z),n.copy(d).add(m).add(p),n.z=n.z+r,this.dollyTo(r,!1),this.setFocalOffset(-n.x,n.y,-n.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,r){if(null===t){this._viewport=null;return}this._viewport=this._viewport||new s.Vector4,"number"==typeof t?this._viewport.set(t,e,i,r):this._viewport.copy(t)}getDistanceToFitBox(t,e,i,s=!1){if(j(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let r=t/e,h=this._camera.getEffectiveFOV()*V,o=this._camera.aspect;return .5*((s?r>o:r<o)?e:t/o)/Math.tan(.5*h)+.5*i}getDistanceToFitSphere(t){if(j(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let e=this._camera.getEffectiveFOV()*V,i=2*Math.atan(Math.tan(.5*e)*this._camera.aspect);return t/Math.sin(.5*(1<this._camera.aspect?e:i))}getTarget(t,e=!0){return(t&&t.isVector3?t:new s.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new s.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new s.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new s.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%M,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=M),this._spherical.theta+=M*Math.round((this._sphericalEnd.theta-this._spherical.theta)/M)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!Z(this._camera.up.x,this._cameraUp0.x)||!Z(this._camera.up.y,this._cameraUp0.y)||!Z(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let t=this.getPosition(n);this.updateCameraUp(),this.setPosition(t.x,t.y,t.z)}return Promise.all([this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)])}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,h),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let t=n.subVectors(this._target,this._camera.position).normalize(),e=l.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();let i=this.getPosition(n);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){let e=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,r=u.subVectors(this._targetEnd,this._target),h=E.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(Y(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let e=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=K(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,e,1/0,t),this._needsUpdate=!0}if(Y(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let e=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=K(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,e,1/0,t),this._needsUpdate=!0}if(Y(s))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let e=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=K(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,e,this.maxSpeed,t),this._needsUpdate=!0}if(Y(r.x)&&Y(r.y)&&Y(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let e=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;X(this._target,this._targetEnd,this._targetVelocity,e,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(Y(h.x)&&Y(h.y)&&Y(h.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let e=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;X(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,e,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(Y(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let e=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=K(this._zoom,this._zoomEnd,this._zoomVelocity,e,1/0,t)}if(this.dollyToCursor){if(P(this._camera)&&0!==this._changedDolly){let t=this._spherical.radius-this._lastDistance,e=this._camera,i=this._getCameraDirection(c),s=n.copy(i).cross(e.up).normalize();0===s.lengthSq()&&(s.x=1);let r=l.crossVectors(s,i),h=this._sphericalEnd.radius*Math.tan(e.getEffectiveFOV()*V*.5),o=(this._sphericalEnd.radius-t-this._sphericalEnd.radius)/this._sphericalEnd.radius,a=_.copy(this._targetEnd).add(s.multiplyScalar(this._dollyControlCoord.x*h*e.aspect)).add(r.multiplyScalar(this._dollyControlCoord.y*h)),d=n.copy(this._targetEnd).lerp(a,o),m=this._lastDollyDirection===F.IN&&this._spherical.radius<=this.minDistance,p=this._lastDollyDirection===F.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(m||p)){this._sphericalEnd.radius-=t,this._spherical.radius-=t;let e=l.copy(i).multiplyScalar(-t);d.add(e)}this._boundary.clampPoint(d,d);let u=l.subVectors(d,this._targetEnd);this._targetEnd.copy(d),this._target.add(u),this._changedDolly-=t,Y(this._changedDolly)&&(this._changedDolly=0)}else if(b(this._camera)&&0!==this._changedZoom){let t=this._zoom-this._lastZoom,e=this._camera,i=n.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(e.near+e.far)/(e.near-e.far)).unproject(e),s=l.set(0,0,-1).applyQuaternion(e.quaternion),r=_.copy(i).add(s.multiplyScalar(-i.dot(e.up))),h=-(this._zoom-t-this._zoom)/this._zoom,o=this._getCameraDirection(c),a=this._targetEnd.dot(o),d=n.copy(this._targetEnd).lerp(r,h),m=d.dot(o),p=o.multiplyScalar(m-a);d.sub(p),this._boundary.clampPoint(d,d);let u=l.subVectors(d,this._targetEnd);this._targetEnd.copy(d),this._target.add(u),this._changedZoom-=t,Y(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),Y(this._focalOffset.x)&&Y(this._focalOffset.y)&&Y(this._focalOffset.z)||(this._camera.updateMatrixWorld(),d.setFromMatrixColumn(this._camera.matrix,0),m.setFromMatrixColumn(this._camera.matrix,1),p.setFromMatrixColumn(this._camera.matrix,2),d.multiplyScalar(this._focalOffset.x),m.multiplyScalar(-this._focalOffset.y),p.multiplyScalar(this._focalOffset.z),n.copy(d).add(m).add(p),this._camera.position.add(n)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),n.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let T=this._needsUpdate;return T&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):T?(this.dispatchEvent({type:"update"}),Y(e,this.restThreshold)&&Y(i,this.restThreshold)&&Y(s,this.restThreshold)&&Y(r.x,this.restThreshold)&&Y(r.y,this.restThreshold)&&Y(r.z,this.restThreshold)&&Y(h.x,this.restThreshold)&&Y(h.y,this.restThreshold)&&Y(h.z,this.restThreshold)&&Y(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!T&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=T,this._needsUpdate=!1,T}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:N(this.maxDistance),minZoom:this.minZoom,maxZoom:N(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:N(this.maxPolarAngle),minAzimuthAngle:N(this.minAzimuthAngle),maxAzimuthAngle:N(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:n.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){let i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=B(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=B(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=B(i.maxPolarAngle),this.minAzimuthAngle=B(i.minAzimuthAngle),this.maxAzimuthAngle=B(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),T.setFromVector3(n.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(T.theta,T.phi,e),this.dollyTo(T.radius,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version","2.9.0"),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,i){let s=e.lengthSq();if(0===s)return t;let r=l.copy(e).add(t),h=this._boundary.clampPoint(r,_).sub(r),o=h.lengthSq();if(0===o)return t.add(e);if(o===s)return t;if(0===i)return t.add(e).add(h);{let s=1+i*o/e.dot(h);return t.add(l.copy(e).multiplyScalar(s)).add(h.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(P(this._camera)){let t=this._camera,e=t.near,i=Math.tan(t.getEffectiveFOV()*V*.5)*e,s=i*t.aspect;this._nearPlaneCorners[0].set(-s,-i,0),this._nearPlaneCorners[1].set(s,-i,0),this._nearPlaneCorners[2].set(s,i,0),this._nearPlaneCorners[3].set(-s,i,0)}else if(b(this._camera)){let t=this._camera,e=1/t.zoom,i=t.left*e,s=t.right*e,r=t.top*e,h=t.bottom*e;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(s,r,0),this._nearPlaneCorners[2].set(s,h,0),this._nearPlaneCorners[3].set(i,h,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||j(this._camera,"_collisionTest"))return t;let e=this._getTargetDirection(c);U.lookAt(r,e,this._camera.up);for(let i=0;i<4;i++){let s=l.copy(this._nearPlaneCorners[i]);s.applyMatrix4(U);let r=_.addVectors(this._target,s);x.set(r,e),x.far=this._spherical.radius+1;let h=x.intersectObjects(this.colliderMeshes);0!==h.length&&h[0].distance<t&&(t=h[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;let e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{let e=()=>{this.removeEventListener("rest",e),t()};this.addEventListener("rest",e)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new s.Sphere){let i=e.center;O.makeEmpty(),t.traverseVisible(t=>{t.isMesh&&O.expandByObject(t)}),O.getCenter(i);let r=0;return t.traverseVisible(t=>{if(!t.isMesh)return;let e=t.geometry.clone();e.applyMatrix4(t.matrixWorld);let s=e.attributes.position;for(let t=0,e=s.count;t<e;t++)n.fromBufferAttribute(s,t),r=Math.max(r,i.distanceToSquared(n))}),e.radius=Math.sqrt(r),e}}let $=(0,w.forwardRef)((t,e)=>{(0,w.useMemo)(()=>{let t={Box3:A.Box3,MathUtils:{clamp:A.MathUtils.clamp},Matrix4:A.Matrix4,Quaternion:A.Quaternion,Raycaster:A.Raycaster,Sphere:A.Sphere,Spherical:A.Spherical,Vector2:A.Vector2,Vector3:A.Vector3,Vector4:A.Vector4};J.install({THREE:t}),(0,R.e)({CameraControlsImpl:J})},[]);let{camera:i,domElement:s,makeDefault:r,onStart:h,onEnd:o,onChange:a,regress:n,...l}=t,_=(0,R.D)(t=>t.camera),c=(0,R.D)(t=>t.gl),d=(0,R.D)(t=>t.invalidate),m=(0,R.D)(t=>t.events),p=(0,R.D)(t=>t.setEvents),u=(0,R.D)(t=>t.set),E=(0,R.D)(t=>t.get),T=(0,R.D)(t=>t.performance),g=i||_,O=s||m.connected||c.domElement,y=(0,w.useMemo)(()=>new J(g),[g]);return(0,R.F)((t,e)=>{y.enabled&&y.update(e)},-1),(0,w.useEffect)(()=>(y.connect(O),()=>void y.disconnect()),[O,y]),(0,w.useEffect)(()=>{let t=t=>{d(),n&&T.regress(),a&&a(t)},e=t=>{h&&h(t)},i=t=>{o&&o(t)};return y.addEventListener("update",t),y.addEventListener("controlstart",e),y.addEventListener("controlend",i),y.addEventListener("control",t),y.addEventListener("transitionstart",t),y.addEventListener("wake",t),()=>{y.removeEventListener("update",t),y.removeEventListener("controlstart",e),y.removeEventListener("controlend",i),y.removeEventListener("control",t),y.removeEventListener("transitionstart",t),y.removeEventListener("wake",t)}},[y,h,o,d,p,n,a]),(0,w.useEffect)(()=>{if(r){let t=E().controls;return u({controls:y}),()=>u({controls:t})}},[r,y]),w.createElement("primitive",(0,D.Z)({ref:e,object:y},l))})},4725:function(t,e,i){i.d(e,{c:function(){return n}});var s=i(1119),r=i(2265),h=i(8478),o=i(1448);let a=t=>"function"==typeof t,n=r.forwardRef(({envMap:t,resolution:e=256,frames:i=1/0,makeDefault:n,children:l,..._},c)=>{let d=(0,h.D)(({set:t})=>t),m=(0,h.D)(({camera:t})=>t),p=(0,h.D)(({size:t})=>t),u=r.useRef(null);r.useImperativeHandle(c,()=>u.current,[]);let E=r.useRef(null),T=function(t,e,i){let s=(0,h.D)(t=>t.size),a=(0,h.D)(t=>t.viewport),n="number"==typeof t?t:s.width*a.dpr,l=s.height*a.dpr,{samples:_=0,depth:c,...d}=("number"==typeof t?void 0:t)||{},m=r.useMemo(()=>{let t=new o.WebGLRenderTarget(n,l,{minFilter:o.LinearFilter,magFilter:o.LinearFilter,type:o.HalfFloatType,...d});return c&&(t.depthTexture=new o.DepthTexture(n,l,o.FloatType)),t.samples=_,t},[]);return r.useLayoutEffect(()=>{m.setSize(n,l),_&&(m.samples=_)},[_,m,n,l]),r.useEffect(()=>()=>m.dispose(),[]),m}(e);r.useLayoutEffect(()=>{_.manual||(u.current.aspect=p.width/p.height)},[p,_]),r.useLayoutEffect(()=>{u.current.updateProjectionMatrix()});let g=0,O=null,y=a(l);return(0,h.F)(e=>{y&&(i===1/0||g<i)&&(E.current.visible=!1,e.gl.setRenderTarget(T),O=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,u.current),e.scene.background=O,e.gl.setRenderTarget(null),E.current.visible=!0,g++)}),r.useLayoutEffect(()=>{if(n)return d(()=>({camera:u.current})),()=>d(()=>({camera:m}))},[u,n,d]),r.createElement(r.Fragment,null,r.createElement("perspectiveCamera",(0,s.Z)({ref:u},_),!y&&l),r.createElement("group",{ref:E},y&&l(T.texture)))})}}]);